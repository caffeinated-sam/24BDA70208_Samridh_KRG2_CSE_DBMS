-- Create schema_violations table
CREATE TABLE schema_violations (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    schema_name VARCHAR2(50),
    violation_count NUMBER
);

-- Insert data
INSERT INTO schema_violations (schema_name, violation_count) VALUES ('Finance', 0);
INSERT INTO schema_violations (schema_name, violation_count) VALUES ('HR', 2);
INSERT INTO schema_violations (schema_name, violation_count) VALUES ('Sales', 5);
INSERT INTO schema_violations (schema_name, violation_count) VALUES ('Security', 9);
INSERT INTO schema_violations (schema_name, violation_count) VALUES ('Admin', 1);

COMMIT;

-- Select with violation status
SELECT 
    schema_name,
    violation_count,
    CASE
        WHEN violation_count = 0 THEN 'No Violation'
        WHEN violation_count BETWEEN 1 AND 3 THEN 'Minor Violation'
        WHEN violation_count BETWEEN 4 AND 7 THEN 'Moderate Violation'
        ELSE 'Critical Violation'
    END AS violation_status
FROM schema_violations;

-- Add approval_status column
ALTER TABLE schema_violations ADD (approval_status VARCHAR2(20));

-- Update approval_status based on violation_count
UPDATE schema_violations
SET approval_status =
    CASE
        WHEN violation_count = 0 THEN 'Approved'
        WHEN violation_count BETWEEN 1 AND 5 THEN 'Needs Review'
        ELSE 'Rejected'
    END;

COMMIT;

-- View updated table
SELECT * FROM schema_violations;

-- PL/SQL anonymous block for status message
DECLARE
    v_count NUMBER := 4;
BEGIN
    IF v_count = 0 THEN
        DBMS_OUTPUT.PUT_LINE('System is clean.');
    ELSIF v_count <= 5 THEN
        DBMS_OUTPUT.PUT_LINE('System has minor issues.');
    ELSE
        DBMS_OUTPUT.PUT_LINE('System has critical violations!');
    END IF;
END;
/

-- Create students table
CREATE TABLE students (
    name VARCHAR2(50),
    marks NUMBER
);

-- Insert student data
INSERT INTO students (name, marks) VALUES ('Jay', 92);
INSERT INTO students (name, marks) VALUES ('Sam', 75);
INSERT INTO students (name, marks) VALUES ('sahil', 61);
INSERT INTO students (name, marks) VALUES ('Pranav', 48);

COMMIT;

-- Select students with grades
SELECT 
    name, 
    marks,
    CASE
        WHEN marks >= 90 THEN 'A Grade'
        WHEN marks >= 70 THEN 'B Grade'
        WHEN marks >= 50 THEN 'C Grade'
        ELSE 'Fail'
    END AS grade
FROM students;

-- Order schema_violations by severity
SELECT schema_name, violation_count
FROM schema_violations
ORDER BY
    CASE
        WHEN violation_count = 0 THEN 1
        WHEN violation_count BETWEEN 1 AND 3 THEN 2
        WHEN violation_count BETWEEN 4 AND 7 THEN 3
        ELSE 4
    END;
    